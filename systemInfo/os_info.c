/* This program only can run on Linux.
 * 
 */
#include <stdio.h>
#include <sys/utsname.h>
#include <sys/statvfs.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdint.h>
#include <pwd.h>
#include "username.c"
#include "utils.c"
#define GB 1000000000


void hdd_information()
{
    struct statvfs buf;

    if (statvfs("/", &buf) != 0)
    {
        error_print;
    }

    int64_t totalSpace = buf.f_frsize * buf.f_blocks;
    int64_t freeSpace = buf.f_frsize * buf.f_bfree;
    int64_t totalSpaceInGb = totalSpace / GB;
    int64_t freeSpaceInGb = freeSpace / GB;

    // long long totalSpace = buf.f_frsize * buf.f_blocks;
    // long long freeSpace = buf.f_frsize * buf.f_bfree;
    puts("\n\tHDD info:");
    printf("Total: \t\t%lld (%lld Gb aprox.)\n", totalSpace, totalSpaceInGb);
    printf("Free: \t\t%lld (%lld Gb aprox.)\n", freeSpace, freeSpaceInGb);
}

void ram_information()
{
    long pageSize = sysconf(_SC_PAGE_SIZE);
    long numPages = sysconf(_SC_PHYS_PAGES);
    long totalMemoryInBits = pageSize * numPages;
    long totalMemoryInGb = totalMemoryInBits / GB;

    puts("\n\tRAM info:");
    printf("Total RAM:\t%ld (%ld Gb aprox.)\n", totalMemoryInBits, totalMemoryInGb);
}

void processor_information() 
{
    long nProcs = sysconf(_SC_NPROCESSORS_ONLN);
    long hzProcs= sysconf(_SC_CLK_TCK);

    if (nProcs == -1 && hzProcs == -1)
    {
        error_print();
    }

    puts("\n\tProcessor info:");
    printf("Num procs:\t%ld\n", nProcs);
    printf("Hz procs:\t%ld\n", hzProcs);
}

void main_information()
{
    struct utsname buf;

    if (uname(&buf) != 0)
    {
        error_print();
    }

    printf("OS:\t\t%s\n", buf.sysname);
    printf("Ver:\t\t%s\n", buf.release);
    printf("Node name:\t%s\n", buf.nodename);
    printf("Arch:\t\t%s\n", buf.machine);

}

int main(void)
{

    main_information();
    processor_information();
    ram_information();
    username_information();
    hdd_information();
}