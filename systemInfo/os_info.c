/* This program only can run on Linux.
 * 
 */
#include <stdio.h>
#include <sys/utsname.h>
#include <sys/statvfs.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdint.h>
#include <pwd.h>
#include "username.c"
#include "utils.c"
#define GB 1000000000

struct Hdd {
    int64_t totalSpace;
    int64_t freeSpace;
    int64_t totalSpaceInGb;
    int64_t freeSpaceInGb;
};

struct Hdd hdd_information()
{

    // TODO: Solve bug of garbage values in the struct.
    struct statvfs buf;
    struct Hdd info;
    info.totalSpace = buf.f_frsize * buf.f_blocks;
    info.freeSpace = buf.f_frsize * buf.f_bfree;
    info.totalSpaceInGb = info.totalSpace / GB;
    info.freeSpaceInGb = info.freeSpace / GB;

    if (statvfs("/", &buf) != 0)
    {
        error_print();
        return (struct Hdd){0, 0, 0, 0};
    }

    puts("\n\tHDD info:");
    printf("Total: \t\t%ld (%ld Gb aprox.)\n", info.totalSpace, info.totalSpaceInGb);
    printf("Free: \t\t%ld (%ld Gb aprox.)\n", info.freeSpace, info.freeSpaceInGb);
    return info;
}

int64_t ram_information()
{
    long pageSize = sysconf(_SC_PAGE_SIZE);
    long numPages = sysconf(_SC_PHYS_PAGES);
    long totalMemoryInBits = pageSize * numPages;
    long totalMemoryInGb = totalMemoryInBits / GB;

    puts("\n\tRAM info:");
    printf("Total RAM:\t%ld (%ld Gb aprox.)\n", totalMemoryInBits, totalMemoryInGb);
    return totalMemoryInBits;
}

void processor_information() 
{
    long nProcs = sysconf(_SC_NPROCESSORS_ONLN);
    long hzProcs= sysconf(_SC_CLK_TCK);

    if (nProcs == -1 && hzProcs == -1)
    {
        error_print();
    }

    puts("\n\tProcessor info:");
    printf("Num procs:\t%ld\n", nProcs);
    printf("Hz procs:\t%ld\n", hzProcs);
}

void main_information()
{
    struct utsname buf;

    if (uname(&buf) != 0)
    {
        error_print();
    }

    printf("OS:\t\t%s\n", buf.sysname);
    printf("Ver:\t\t%s\n", buf.release);
    printf("Node name:\t%s\n", buf.nodename);
    printf("Arch:\t\t%s\n", buf.machine);

}

int main(void)
{
    main_information();
    processor_information();
    ram_information();
    username_information();
    struct Hdd info = hdd_information();
}