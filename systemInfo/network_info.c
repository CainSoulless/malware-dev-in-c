#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <sys/socket.h>
#include <sys/ioctl.h>
#include <net/if.h>
#include <ifaddrs.h>
#include <arpa/inet.h>

#include "utils.c" 


int interface_information()
{
    // TODO: This function it's actually not working.
    struct ifaddrs *ifaddr, *ifa;
    int family, soc, n;

    if (getifaddrs(&ifaddr) == -1) 
    {
        error_print();
        return -1;
    }

    for (ifa = ifaddr; ifa != NULL; ifa = ifa->ifa_next)
    {
        family = ifa->ifa_addr->sa_family;

        if (family == AF_INET)
        {
            soc = socket(AF_INET, SOCK_DGRAM, 0);
            if (soc == -1 || ioctl(soc, SIOCGIFFLAGS, &(ifa->ifa_name)) == -1)
            {
                error_print();
                return -1;
            }

            struct ifreq ifreq;
            strncpy(ifreq.ifr_name, ifa->ifa_name, IFNAMSIZ - 1);

            if (ioctl(soc, SIOCGIFFLAGS, &ifreq) == 0)
            {
                if (ifreq.ifr_flags & IFF_UP)
                {
                    printf("%s\n", ifa->ifa_name);
                    close(soc);
                    break;
                }
            }
            close(soc);
        }
    }
    freeifaddrs(ifaddr);
}

void mac_information()
{
    struct ifreq ifred;
    int sock;

    char interface[] = "wlp2s0";

    sock = socket(AF_INET, SOCK_DGRAM, 0);
    ifred.ifr_addr.sa_family = AF_INET;
    strncpy(ifred.ifr_name, interface, IFNAMSIZ - 1);

    ioctl(sock, SIOCGIFHWADDR, &ifred);

    close(sock);

    printf("MAC address: %.2X:%.2X:%.2X:%.2X:%.2X:%.2X\n" ,
    (unsigned char)ifred.ifr_hwaddr.sa_data[0],
    (unsigned char)ifred.ifr_hwaddr.sa_data[1],
    (unsigned char)ifred.ifr_hwaddr.sa_data[2],
    (unsigned char)ifred.ifr_hwaddr.sa_data[3],
    (unsigned char)ifred.ifr_hwaddr.sa_data[4],
    (unsigned char)ifred.ifr_hwaddr.sa_data[5]);

}

int main(int argc, char const *argv[])
{
    mac_information();
    interface_information();
    return 0;
}
