#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <sys/socket.h>
#include <sys/ioctl.h>
#include <net/if.h>
#include <ifaddrs.h>
#include <arpa/inet.h>

#include "utils.c" 


// const char * const * interface_information()
struct Interfaces interface_information()
{
    const char *interfaces[10];
    int count = 0;

    struct ifaddrs *addrs,*tmp;

    getifaddrs(&addrs);
    tmp = addrs;

    while (tmp)
    {
        if (tmp->ifa_addr && tmp->ifa_addr->sa_family == AF_PACKET)
        {
            interfaces[count] = tmp->ifa_name;
            count++;
        }    
        tmp = tmp->ifa_next;
    }

    freeifaddrs(addrs);

    // Block oriented just for return the string's array.
    // C stuffs, lol.
    const char **copy_of_array = malloc(count * sizeof(*copy_of_array));
    for (int i = 0; i < count; i++)
    {
        copy_of_array[i] = interfaces[i];
    }
    
    return copy_of_array;
    // TODO: This function it's actually not working.
    // struct ifaddrs *ifaddr, *ifa;
    // int family, soc, n;

    // if (getifaddrs(&ifaddr) == -1) 
    // {
    //     error_print();
    //     return -1;
    // }

    // for (ifa = ifaddr; ifa != NULL; ifa = ifa->ifa_next)
    // {
    //     family = ifa->ifa_addr->sa_family;

    //     if (family == AF_INET)
    //     {
    //         soc = socket(AF_INET, SOCK_DGRAM, 0);
    //         if (soc == -1 || ioctl(soc, SIOCGIFFLAGS, &(ifa->ifa_name)) == -1)
    //         {
    //             error_print();
    //             return -1;
    //         }

    //         struct ifreq ifreq;
    //         strncpy(ifreq.ifr_name, ifa->ifa_name, IFNAMSIZ - 1);

    //         if (ioctl(soc, SIOCGIFFLAGS, &ifreq) == 0)
    //         {
    //             if (ifreq.ifr_flags & IFF_UP)
    //             {
    //                 printf("%s\n", ifa->ifa_name);
    //                 close(soc);
    //                 break;
    //             }
    //         }
    //         close(soc);
    //     }
    // }
    // freeifaddrs(ifaddr);
}

void mac_information()
{
    struct ifreq ifr;
    int sock;

    // char interface[] = "wlp2s0";
    const char * const *interface = interface_information();

    for (int i = 0; i < 3; i++)
    {
        printf("%s\n", interface[i]);
    }
    

    // sock = socket(AF_INET, SOCK_DGRAM, 0);
    // ifr.ifr_addr.sa_family = AF_INET;
    // strncpy(ifr.ifr_name, interface, IFNAMSIZ - 1);

    // ioctl(sock, SIOCGIFHWADDR, &ifr);

    // close(sock);

    // printf("MAC address: %.2X:%.2X:%.2X:%.2X:%.2X:%.2X\n" ,
    // (unsigned char)ifr.ifr_hwaddr.sa_data[0],
    // (unsigned char)ifr.ifr_hwaddr.sa_data[1],
    // (unsigned char)ifr.ifr_hwaddr.sa_data[2],
    // (unsigned char)ifr.ifr_hwaddr.sa_data[3],
    // (unsigned char)ifr.ifr_hwaddr.sa_data[4],
    // (unsigned char)ifr.ifr_hwaddr.sa_data[5]);

}

int main(int argc, char const *argv[])
{
    mac_information();
    interface_information();
    return 0;
}
