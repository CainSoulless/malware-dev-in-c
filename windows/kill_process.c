"This file is create to kill the self-process called `conhost.exe`"
#include <windows.h>
#include <tlhelp32.h>

void killProcessByName()
{
    HANDLE processSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPALL, 0);                           // Get the whole process in the OS.
    PROCESSENTRY32 pEntry;
    pEntry.dwSize = sizeof(PROCESSENTRY32);
    BOOL hRes = Process32First(processSnapshot, &pEntry);                                           // Get the first process of the snapshot `processSnapshot`
    while (hRes)
    {
        if (strcmp(pEntry.szExeFile, "conhost.exe") == 0)
        {
            // We use the function OpenProcess with PROCESS_TERMINATE flag to kill the process itself.
            HANDLE hProcess = OpenProcess(PROCESS_TERMINATE, 0, (DWORD)pEntry.th32ProcessID);       
            if (hProcess != NULL)
            {
                TerminateProcess(hProcess, 9);
                CloseHandle(hProcess);
            }
        }
        hRes = Process32Next(processSnapshot, &pEntry);
    }
    CloseHandle(processSnapshot);
}

int main(void)
{
    killProcessByName();
}